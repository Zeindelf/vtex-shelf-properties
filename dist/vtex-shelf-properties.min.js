/*!!
 * VtexShelfProperties.js v0.1.5
 * https://github.com/zeindelf/vtex-shelf-properties
 *
 * Copyright (c) 2018-2018 Zeindelf
 * Released under the MIT license
 *
 * Date: 2018-02-14T06:12:22.122Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e.VTEX=e.VTEX||{},e.VTEX.VtexShelfProperties=t())}(this,function(){"use strict";var e="0.9.1",t={messages:{vtexUtils:"VtexUtils.js is required and must be an instance. Download it from https://www.npmjs.com/package/vtex-utils",vtexUtilsVersion:e,vtexUtilsVersionMessage:"VtexUtils version must be higher than 0.9.1. Download last version on https://www.npmjs.com/package/vtex-utils",fnProperties:"Callback must be a function",shelfClass:"shelfClass is required and must be a string, eg. '.js--shelf-class'"}},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),i=new(function(){function e(){s(this,e)}return n(e,[{key:"_requestEndEvent",value:function(e){var t=new $.Event(e+".vtexShelfProperties");setTimeout(function(){$(document).trigger(t)},0)}},{key:"_validateShelfClass",value:function(e,s){if(s.isUndefined(e)||!s.isString(e))throw new Error(t.messages.shelfClass)}}]),e}()),r={setEventName:function(e){this.eventName=e},setShelfContainer:function(e){i._validateShelfClass(e,this.globalHelpers),this.eventName=this.globalHelpers.isUndefined(this.eventName)?"requestEnd":this.eventName,this.shelfClass=e;var t=$(e+":not(.is--loaded)"),s=[];return!(t.length<1)&&(t.map(function(e,t){var n=$(t).data("productId");s.push(n)}),this._getProducts(s,t))},update:function(){i._validateShelfClass(this.shelfClass,this.globalHelpers),this.setShelfContainer(this.shelfClass)},_getProducts:function(e,t){var s=this;return this.vtexCatalog.searchProductArray(e).then(function(e){t.map(function(t,n){var i=$(n),r=i.data("productId");for(var a in e)({}).hasOwnProperty.call(e,a)&&parseInt(r)===parseInt(a)&&(s.fnProperties.apply(s,[i,e[a]]),i.addClass("is--loaded"))})}).then(function(){return i._requestEndEvent(s.eventName)})}};return function e(n,i){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(s(this,e),this.version="0.1.5",this.name="@VtexShelfProperties",void 0===n)throw new TypeError(t.messages.vtexUtils);if("@VtexUtils"!==n.name)throw new TypeError(t.messages.vtexUtils);if(n.version<t.messages.vtexUtilsVersion)throw new Error(t.messages.vtexUtilsVersionMessage);if(!n.globalHelpers.isFunction(i))throw new TypeError(t.messages.fnProperties);this.fnProperties=i,this.globalHelpers=n.globalHelpers,this.vtexCatalog=new n.VtexCatalog(a),this.globalHelpers.extend(e.prototype,r)}});