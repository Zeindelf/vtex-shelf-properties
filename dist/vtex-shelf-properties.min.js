/*!!
 * VtexShelfProperties.js v0.4.0
 * https://github.com/zeindelf/vtex-shelf-properties
 *
 * Copyright (c) 2018-2018 Zeindelf
 * Released under the MIT license
 *
 * Date: 2018-05-28T04:53:06.051Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e.VTEX=e.VTEX||{},e.VTEX.VtexShelfProperties=t())}(this,function(){"use strict";var e="1.0.0",n={MESSAGES:{vtexUtils:"VtexUtils.js is required and must be an instance. Download it from https://www.npmjs.com/package/vtex-utils",vtexCatalog:"VtexCatalog.js is required and must be an instance. Download it from https://www.npmjs.com/package/vtex-catalog",vtexCatalogVersion:e,vtexCatalogVersionMessage:"VtexCatalog version must be higher than 1.0.0. Download last version on https://www.npmjs.com/package/vtex-catalog",fnProperties:"Callback must be a function",shelfClass:"shelfClass is required and must be a string, e.g. '.js--shelf-class'"}},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function a(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,s){return t&&a(e.prototype,t),s&&a(e,s),e}}(),a=new(function(){function e(){r(this,e)}return t(e,[{key:"_validateShelfClass",value:function(e,t){if(t.isUndefined(e)||!t.isString(e))throw new Error(n.MESSAGES.shelfClass)}},{key:"_requestEndEvent",value:function(e){var t=$.Event(e+".vtexShelfProperties");$(document).trigger(t)}}]),e}()),o={setEventName:function(e){this.eventName=e},setLoadedClass:function(e){this.loadedClass=e},setShelfContainer:function(e){a._validateShelfClass(e,this.globalHelpers),this.eventName=this.globalHelpers.isUndefined(this.eventName)?"requestEnd":this.eventName,this.loadedClass=this.globalHelpers.isUndefined(this.loadedClass)?"is--loaded":this.loadedClass,this.shelfClass=e;var t=$(e+":not(."+this.loadedClass+")");if(t.length<1)return!1;var s=t.map(function(e,t){return $(t).data("productId")}).get();return this._getProducts(s,t)},update:function(){a._validateShelfClass(this.shelfClass,this.globalHelpers),this.setShelfContainer(this.shelfClass)},_getProducts:function(e,t){var o=this;return this.vtexCatalog.searchProductArray(e).then(function(r){t.map(function(e,t){var s=$(t),a=s.data("productId");for(var n in r)({}).hasOwnProperty.call(r,n)&&parseInt(a,10)===parseInt(n,10)&&(o.fnProperties.apply(o,[s,r[n]]),s.addClass(o.loadedClass))})}).always(function(){return a._requestEndEvent(o.eventName)})}};return function e(t,s,a){if(r(this,e),this.version="0.4.0",this.name="@VtexShelfProperties",void 0===t)throw new TypeError(n.MESSAGES.vtexUtils);if(void 0===s)throw new TypeError(n.MESSAGES.vtexCatalog);if(this.vtexCatalog=s,"@VtexCatalog"!==this.vtexCatalog.name)throw new TypeError(n.MESSAGES.vtexCatalog);if(this.vtexCatalog.version<n.MESSAGES.vtexCatalogVersion)throw new Error(n.MESSAGES.vtexCatalogVersionMessage);if(!t.globalHelpers.isFunction(a))throw new TypeError(n.MESSAGES.fnProperties);this.fnProperties=a,this.globalHelpers=t.globalHelpers,this.globalHelpers.extend(e.prototype,o)}});